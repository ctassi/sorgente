<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CtrlAdminTest.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">seq (1) (2-lug-2014 22.31.08)</a> &gt; <a href="../../index.html" class="el_group">seq</a> &gt; <a href="../index.html" class="el_bundle">src/test/java</a> &gt; <a href="index.source.html" class="el_package">com.sequenziatore.server.controller</a> &gt; <span class="el_source">CtrlAdminTest.java</span></div><h1>CtrlAdminTest.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2014 Dainese Matteo, De Nadai Andrea, Girotto Giacomo, Pavanello Mirko, Romagnosi Nicolò, Sartoretto Massimiliano, Visentin Luca
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * 	File contentente la classe CtrlAdminTest
 * 
 *	@file		CtrlAdminTest.java
 *	@author		DeSQ
 *	@date		2014-05-14
 *	@version	1.0
 */

package com.sequenziatore.server.controller;

import static org.mockito.Mockito.*;
import static org.junit.Assert.*;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringReader;
import java.io.Writer;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.GregorianCalendar;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.hibernate.Query;
import org.json.JSONArray;
import org.json.JSONObject;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.Test;

import com.sequenziatore.server.databaseutil.util.HibernateUtil;
import com.sequenziatore.server.entity.DataCollection;
import com.sequenziatore.server.entity.Process;
import com.sequenziatore.server.entity.Step;
import com.sequenziatore.server.entity.Subscription;
import com.sequenziatore.server.entity.User;
import com.sequenziatore.server.entity.DataCollection.EnumState;
import com.sequenziatore.server.entity.Step.EnumParallelism;

/**
 *	Classe contenente tutti i test di unità dei metodi della classe CtrlAdmin.
 *
 *	@author 	DeSQ
 */
<span class="fc" id="L67">public class CtrlAdminTest {</span>

	/**
	 * Pulisce il database prima di iniziare ad eseguire i test.
	 * @throws Exception segnala un problema di connessione al database
	 */
	@Before
	public void clean() throws Exception
	{
		//pulizia database
<span class="fc" id="L77">	    HibernateUtil.getSession().beginTransaction();</span>
	    
	    //elimina le data collection
<span class="fc" id="L80">	    Query deleteDataCollection = HibernateUtil.getSession().createQuery(&quot;delete DataCollection&quot;);</span>
<span class="fc" id="L81">	    deleteDataCollection.executeUpdate();</span>
	    
	    //elimina le iscrizioni ai processi
<span class="fc" id="L84">	    Query unsubscribeToProcess = HibernateUtil.getSession().createQuery(&quot;delete Subscription&quot;);</span>
<span class="fc" id="L85">	    unsubscribeToProcess.executeUpdate();</span>
	    
	    //elimina i passi di tutti i processi
<span class="fc" id="L88">	    Query deleteTestStep = HibernateUtil.getSession().createQuery(&quot;delete Step&quot;);</span>
<span class="fc" id="L89">	    deleteTestStep.executeUpdate();</span>
	    
	    //elimina i processi
<span class="fc" id="L92">	    Query deleteTestProcess = HibernateUtil.getSession().createQuery(&quot;delete Process&quot;);</span>
<span class="fc" id="L93">	    deleteTestProcess.executeUpdate();</span>
	    
	    //elimina gli utenti registrati
<span class="fc" id="L96">	    Query deleteTestUser = HibernateUtil.getSession().createQuery(&quot;delete User&quot;);</span>
<span class="fc" id="L97">	    deleteTestUser.executeUpdate();</span>
	    
<span class="fc" id="L99">	    HibernateUtil.commitTransaction();</span>
<span class="fc" id="L100">	}</span>
	
	/**
	 *	Pulisce il database quando sono terminati tutti i test.
	 * @throws Exception segnala un problema di connessione al database
	 */
	@AfterClass
	public static void finalClean() throws Exception
	{
		//pulizia database
<span class="fc" id="L110">	    HibernateUtil.getSession().beginTransaction();</span>
	    
	    //elimina le data collection
<span class="fc" id="L113">	    Query deleteDataCollection = HibernateUtil.getSession().createQuery(&quot;delete DataCollection&quot;);</span>
<span class="fc" id="L114">	    deleteDataCollection.executeUpdate();</span>
	    
	    //elimina le iscrizioni ai processi
<span class="fc" id="L117">	    Query unsubscribeToProcess = HibernateUtil.getSession().createQuery(&quot;delete Subscription&quot;);</span>
<span class="fc" id="L118">	    unsubscribeToProcess.executeUpdate();</span>
	    
	    //elimina i passi di tutti i processi
<span class="fc" id="L121">	    Query deleteTestStep = HibernateUtil.getSession().createQuery(&quot;delete Step&quot;);</span>
<span class="fc" id="L122">	    deleteTestStep.executeUpdate();</span>
	    
	    //elimina i processi
<span class="fc" id="L125">	    Query deleteTestProcess = HibernateUtil.getSession().createQuery(&quot;delete Process&quot;);</span>
<span class="fc" id="L126">	    deleteTestProcess.executeUpdate();</span>
	    
	    //elimina gli utenti registrati
<span class="fc" id="L129">	    Query deleteTestUser = HibernateUtil.getSession().createQuery(&quot;delete User&quot;);</span>
<span class="fc" id="L130">	    deleteTestUser.executeUpdate();</span>
	    
<span class="fc" id="L132">	    HibernateUtil.commitTransaction();</span>
<span class="fc" id="L133">	}</span>
	
	/**
	 *	Test del metodo ctrlReport() che permette ad un amministratore di ricevere un report su un processo.
	 * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlReport() throws Exception {
<span class="fc" id="L141">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L142">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L143">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L144">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
      //creazione ambiente per l'esecuzione della query
<span class="fc" id="L147">    	HibernateUtil.getSession().beginTransaction();</span>
    	
    	//creazione amministratore
<span class="fc" id="L150">        User testAdmin = new User();</span>
<span class="fc" id="L151">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L152">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L153">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L154">        testAdmin.setUsername(&quot;testAdmin&quot;);</span>
<span class="fc" id="L155">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
    	
    	//creazione utente
<span class="fc" id="L158">        User testUser = new User();</span>
<span class="fc" id="L159">        testUser.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L160">        testUser.setIsAdmin(false);</span>
<span class="fc" id="L161">        testUser.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L162">        testUser.setUsername(&quot;testUser&quot;);</span>
<span class="fc" id="L163">        HibernateUtil.getSession().saveOrUpdate(testUser);</span>
        
        //creazione processo
<span class="fc" id="L166">        Process testProcess = new Process();</span>
<span class="fc" id="L167">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L168">        testProcess.setAvailable(true);</span>
<span class="fc" id="L169">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L170">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L171">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L172">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L173">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L174">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L175">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L178">        Step testStep = new Step();</span>
<span class="fc" id="L179">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L180">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L181">        testStep.setIsGeolocation(false);</span>
<span class="fc" id="L182">        testStep.setIsPhoto(false);</span>
<span class="fc" id="L183">        testStep.setIsText(false);</span>
<span class="fc" id="L184">        testStep.setLevel(1);</span>
<span class="fc" id="L185">        testStep.setParallelism(EnumParallelism.AND);</span>
<span class="fc" id="L186">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L187">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
        
        //inserimento del passo nel processo
<span class="fc" id="L190">        List&lt;Step&gt; testStepList = new ArrayList&lt;Step&gt;();</span>
<span class="fc" id="L191">        testStepList.add(testStep);</span>
<span class="fc" id="L192">        testProcess.setSteps(testStepList);</span>
<span class="fc" id="L193">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
<span class="fc" id="L194">        HibernateUtil.commitTransaction();</span>
		
<span class="fc" id="L196">        String processData = new String(&quot;IdProcess: &quot;+testProcess.getIdProcess());</span>
        
<span class="fc" id="L198">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, &quot;+processData+&quot;}&quot;;</span>
<span class="fc" id="L199">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L200">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L202">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L203">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L205">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L206">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L208">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L209">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L211">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L212">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L213">		}</span>
<span class="nc" id="L214">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L215">        catch (IOException e) {}</span>
        
<span class="fc" id="L217">        Field iParserObject = null;</span>
<span class="fc" id="L218">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L221">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L222">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L223">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L224">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L225">		}</span>
<span class="nc" id="L226">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L227">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L229">		ctrlAdminObject.ctrlReport(request, response);</span>
<span class="fc" id="L230">		assertNotNull(iParserObject);</span>
<span class="fc" id="L231">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L232">    }</span>

    /**
	 *	Test del metodo ctrlStatisticsAdmin() che permette ad un amministratore di visualizzare le statistiche sui propri processi.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlStatisticsAdmin() throws Exception {
<span class="fc" id="L240">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L241">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L242">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L243">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>

        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L246">	    HibernateUtil.getSession().beginTransaction();</span>

    	//creazione amministratore
<span class="fc" id="L249">        User testAdmin = new User();</span>
<span class="fc" id="L250">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L251">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L252">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L253">        testAdmin.setUsername(&quot;testAdmin&quot;);</span>
<span class="fc" id="L254">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
    	
    	//creazione utente
<span class="fc" id="L257">        User testUser = new User();</span>
<span class="fc" id="L258">        testUser.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L259">        testUser.setIsAdmin(false);</span>
<span class="fc" id="L260">        testUser.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L261">        testUser.setUsername(&quot;testUser&quot;);</span>
<span class="fc" id="L262">        HibernateUtil.getSession().saveOrUpdate(testUser);</span>
        
        //creazione processo
<span class="fc" id="L265">        Process testProcess = new Process();</span>
<span class="fc" id="L266">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L267">        testProcess.setAvailable(true);</span>
<span class="fc" id="L268">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L269">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L270">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L271">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L272">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L273">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L274">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L277">        Step testStep = new Step();</span>
<span class="fc" id="L278">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L279">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L280">        testStep.setCheckText(&quot;null&quot;);</span>
<span class="fc" id="L281">        testStep.setIsGeolocation(true);</span>
<span class="fc" id="L282">        testStep.setIsPhoto(true);</span>
<span class="fc" id="L283">        testStep.setIsText(true);</span>
<span class="fc" id="L284">        testStep.setLevel(1);</span>
<span class="fc" id="L285">        testStep.setParallelism(EnumParallelism.NOT);</span>
<span class="fc" id="L286">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L287">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
        
        //inserimento del passo nel processo
<span class="fc" id="L290">        List&lt;Step&gt; testStepList = new ArrayList&lt;Step&gt;();</span>
<span class="fc" id="L291">        testStepList.add(testStep);</span>
<span class="fc" id="L292">        testProcess.setSteps(testStepList);</span>
<span class="fc" id="L293">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //iscrizione dell'utente al processo 
<span class="fc" id="L296">        Subscription testSubscription = new Subscription();</span>
<span class="fc" id="L297">        testSubscription.setComplete(false);</span>
<span class="fc" id="L298">        testSubscription.setIdUser(testUser);</span>
<span class="fc" id="L299">        testSubscription.setIdProcess(testProcess);</span>
<span class="fc" id="L300">        HibernateUtil.getSession().saveOrUpdate(testSubscription);</span>
        
        //creazione di una data collection
<span class="fc" id="L303">        DataCollection testCollection = new DataCollection();</span>
<span class="fc" id="L304">        testCollection.setState(EnumState.TOVERIFY);</span>
<span class="fc" id="L305">        testCollection.setIdStep(testStep);</span>
<span class="fc" id="L306">        testCollection.setIdUser(testUser);</span>
<span class="fc" id="L307">        testCollection.setPhoto(new String(&quot;null&quot;));</span>
<span class="fc" id="L308">        testCollection.setText(&quot;null&quot;);</span>
<span class="fc" id="L309">        testCollection.setLongitude(&quot;null&quot;);</span>
<span class="fc" id="L310">        testCollection.setLatitude(&quot;null&quot;);</span>
<span class="fc" id="L311">        testCollection.setWrongText(true);</span>
<span class="fc" id="L312">        testCollection.setWrongPhoto(true);</span>
<span class="fc" id="L313">        testCollection.setWrongGeolocation(true);</span>
<span class="fc" id="L314">        HibernateUtil.getSession().saveOrUpdate(testCollection);</span>
<span class="fc" id="L315">	    HibernateUtil.commitTransaction();</span>
	    
<span class="fc" id="L317">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, IdProcess: &quot;+testProcess.getIdProcess()+&quot;}&quot;;</span>
<span class="fc" id="L318">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L319">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L321">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L322">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L324">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L325">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L327">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L328">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L330">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L331">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L332">		}</span>
<span class="nc" id="L333">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L334">        catch (IOException e) {}</span>
        
<span class="fc" id="L336">        Field iParserObject = null;</span>
<span class="fc" id="L337">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L340">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L341">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L342">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L343">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L344">		}</span>
<span class="nc" id="L345">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L346">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L348">		ctrlAdminObject.ctrlStatisticsAdmin(request, response);</span>
<span class="fc" id="L349">		assertNotNull(iParserObject);</span>
<span class="fc" id="L350">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L351">    }</span>
    
    /**
	 *	Test del metodo ctrlViewAdminProcessNotActive() che permette ad un amministratore di visualizzare i propri processi che non sono più attivi.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlViewAdminProcessNotActive() throws Exception {
<span class="fc" id="L359">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L360">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L361">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L362">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>

        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L365">	    HibernateUtil.getSession().beginTransaction();</span>

    	//creazione amministratore
<span class="fc" id="L368">        User testAdmin = new User();</span>
<span class="fc" id="L369">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L370">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L371">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L372">        testAdmin.setUsername(&quot;testAdmin&quot;);</span>
<span class="fc" id="L373">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
    	
    	//creazione utente
<span class="fc" id="L376">        User testUser = new User();</span>
<span class="fc" id="L377">        testUser.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L378">        testUser.setIsAdmin(false);</span>
<span class="fc" id="L379">        testUser.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L380">        testUser.setUsername(&quot;testUser&quot;);</span>
<span class="fc" id="L381">        HibernateUtil.getSession().saveOrUpdate(testUser);</span>
        
        //creazione processo
<span class="fc" id="L384">        Process testProcess = new Process();</span>
<span class="fc" id="L385">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L386">        testProcess.setAvailable(true);</span>
<span class="fc" id="L387">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L388">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L389">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L390">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L391">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L392">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L393">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L396">        Step testStep = new Step();</span>
<span class="fc" id="L397">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L398">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L399">        testStep.setCheckText(&quot;null&quot;);</span>
<span class="fc" id="L400">        testStep.setIsGeolocation(true);</span>
<span class="fc" id="L401">        testStep.setIsPhoto(true);</span>
<span class="fc" id="L402">        testStep.setIsText(true);</span>
<span class="fc" id="L403">        testStep.setLevel(1);</span>
<span class="fc" id="L404">        testStep.setParallelism(EnumParallelism.NOT);</span>
<span class="fc" id="L405">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L406">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
        
        //inserimento del passo nel processo
<span class="fc" id="L409">        List&lt;Step&gt; testStepList = new ArrayList&lt;Step&gt;();</span>
<span class="fc" id="L410">        testStepList.add(testStep);</span>
<span class="fc" id="L411">        testProcess.setSteps(testStepList);</span>
<span class="fc" id="L412">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //iscrizione dell'utente al processo 
<span class="fc" id="L415">        Subscription testSubscription = new Subscription();</span>
<span class="fc" id="L416">        testSubscription.setComplete(false);</span>
<span class="fc" id="L417">        testSubscription.setIdUser(testUser);</span>
<span class="fc" id="L418">        testSubscription.setIdProcess(testProcess);</span>
<span class="fc" id="L419">        HibernateUtil.getSession().saveOrUpdate(testSubscription);</span>
        
        //creazione di una data collection
<span class="fc" id="L422">        DataCollection testCollection = new DataCollection();</span>
<span class="fc" id="L423">        testCollection.setState(EnumState.TOVERIFY);</span>
<span class="fc" id="L424">        testCollection.setIdStep(testStep);</span>
<span class="fc" id="L425">        testCollection.setIdUser(testUser);</span>
<span class="fc" id="L426">        testCollection.setPhoto(new String(&quot;null&quot;));</span>
<span class="fc" id="L427">        testCollection.setText(&quot;null&quot;);</span>
<span class="fc" id="L428">        testCollection.setLongitude(&quot;null&quot;);</span>
<span class="fc" id="L429">        testCollection.setLatitude(&quot;null&quot;);</span>
<span class="fc" id="L430">        testCollection.setWrongText(true);</span>
<span class="fc" id="L431">        testCollection.setWrongPhoto(true);</span>
<span class="fc" id="L432">        testCollection.setWrongGeolocation(true);</span>
<span class="fc" id="L433">        HibernateUtil.getSession().saveOrUpdate(testCollection);</span>
<span class="fc" id="L434">	    HibernateUtil.commitTransaction();</span>
	    
<span class="fc" id="L436">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, IdProcess: &quot;+testProcess.getIdProcess()+&quot;}&quot;;</span>
<span class="fc" id="L437">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L438">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L440">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L441">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L443">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L444">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L446">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L447">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L449">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L450">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L451">		}</span>
<span class="nc" id="L452">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L453">        catch (IOException e) {}</span>
        
<span class="fc" id="L455">        Field iParserObject = null;</span>
<span class="fc" id="L456">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L459">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L460">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L461">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L462">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L463">		}</span>
<span class="nc" id="L464">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L465">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L467">		ctrlAdminObject.ctrlViewAdminProcessNotActive(request, response);</span>
<span class="fc" id="L468">		assertNotNull(iParserObject);</span>
<span class="fc" id="L469">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L470">    }</span>
    
	/**
	 *	Test del metodo ctrlViewProcess() che permette ad un amministratore di visualizzare un processo.
	 * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlViewProcess() throws Exception {
<span class="fc" id="L478">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L479">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L480">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L481">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
<span class="fc" id="L483">        HibernateUtil.getSession().beginTransaction();</span>
        //creazione amministratore
<span class="fc" id="L485">        User testAdmin = new User();</span>
<span class="fc" id="L486">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L487">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L488">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L489">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L490">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
        
        //creazione processo
<span class="fc" id="L493">        Process testProcess = new Process();</span>
<span class="fc" id="L494">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L495">        testProcess.setAvailable(true);</span>
<span class="fc" id="L496">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L497">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L498">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L499">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L500">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L501">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L502">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L505">        Step testStep = new Step();</span>
<span class="fc" id="L506">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L507">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L508">        testStep.setIsGeolocation(false);</span>
<span class="fc" id="L509">        testStep.setIsPhoto(false);</span>
<span class="fc" id="L510">        testStep.setIsText(false);</span>
<span class="fc" id="L511">        testStep.setLevel(1);</span>
<span class="fc" id="L512">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L513">        testStep.setParallelism(EnumParallelism.AND);</span>
<span class="fc" id="L514">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
<span class="fc" id="L515">        HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L517">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, IdProcess: &quot;+testProcess.getIdProcess()+&quot;}&quot;;</span>
<span class="fc" id="L518">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L519">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L521">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L522">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L524">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L525">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L527">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L528">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L530">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L531">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L532">		}</span>
<span class="nc" id="L533">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L534">        catch (IOException e) {}</span>
        
<span class="fc" id="L536">        Field iParserObject = null;</span>
<span class="fc" id="L537">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L540">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L541">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L542">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L543">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L544">		}</span>
<span class="nc" id="L545">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L546">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L548">		ctrlAdminObject.ctrlViewProcess(request, response);</span>
<span class="fc" id="L549">		assertNotNull(iParserObject);</span>
<span class="fc" id="L550">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L551">    }</span>
	
    /**
	 *	Test del metodo ctrlModifyProcess() che permette ad un amministratore di modificare un processo.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlModifyProcess() throws Exception {
<span class="fc" id="L559">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L560">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L561">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L562">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
<span class="fc" id="L564">        HibernateUtil.getSession().beginTransaction();</span>
        //creazione amministratore
<span class="fc" id="L566">        User testAdmin = new User();</span>
<span class="fc" id="L567">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L568">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L569">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L570">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L571">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
        
        //creazione processo
<span class="fc" id="L574">        Process testProcess = new Process();</span>
<span class="fc" id="L575">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L576">        testProcess.setAvailable(true);</span>
<span class="fc" id="L577">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L578">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L579">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L580">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L581">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L582">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L583">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L586">        Step testStep = new Step();</span>
<span class="fc" id="L587">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L588">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L589">        testStep.setIsGeolocation(false);</span>
<span class="fc" id="L590">        testStep.setIsPhoto(false);</span>
<span class="fc" id="L591">        testStep.setIsText(false);</span>
<span class="fc" id="L592">        testStep.setLevel(1);</span>
<span class="fc" id="L593">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L594">        testStep.setParallelism(EnumParallelism.AND);</span>
<span class="fc" id="L595">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
<span class="fc" id="L596">        HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L598">        JSONObject date = new JSONObject();</span>
<span class="fc" id="L599">		date.put(&quot;Year&quot;, 2020);</span>
<span class="fc" id="L600">		date.put(&quot;Month&quot;, 12);</span>
<span class="fc" id="L601">		date.put(&quot;Day&quot;, 31);</span>
		
<span class="fc" id="L603">        String processData = new String(&quot;Name: 'test', Description: 'modifiedProcess', TotalLevel: 1, PublicationDate: &quot;+date+&quot;, ClosingDate: &quot;+date+&quot;, EndSubscriptionDate: &quot;+date+&quot;, Available: true&quot;);</span>
<span class="fc" id="L604">        JSONArray stepArray = new JSONArray();</span>
        
<span class="fc" id="L606">        JSONObject stepData = new JSONObject();</span>
<span class="fc" id="L607">		stepData.put(&quot;Level&quot; , 1);</span>
<span class="fc" id="L608">		stepData.put(&quot;Description&quot;, &quot;modifiedStep&quot;);</span>
<span class="fc" id="L609">		stepData.put(&quot;IsPhoto&quot;, true);</span>
<span class="fc" id="L610">		stepData.put(&quot;IsText&quot;, true);</span>
<span class="fc" id="L611">		stepData.put(&quot;IsGeolocation&quot;, true);</span>
<span class="fc" id="L612">		stepData.put(&quot;CheckText&quot;, &quot;&quot;);</span>
<span class="fc" id="L613">		stepData.put(&quot;CheckLatitude&quot;, &quot;&quot;);</span>
<span class="fc" id="L614">		stepData.put(&quot;CheckLongitude&quot;, &quot;&quot;);</span>
<span class="fc" id="L615">		stepData.put(&quot;AdminVerify&quot;, false);</span>
<span class="fc" id="L616">		stepData.put(&quot;Parallelism&quot; , &quot;NOT&quot;);</span>
<span class="fc" id="L617">		stepData.put(&quot;IdProcess&quot; , testProcess.getIdProcess());</span>
<span class="fc" id="L618">        stepArray.put(stepData);</span>
        
<span class="fc" id="L620">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, &quot;+processData+&quot;, StepList: &quot;+stepArray+&quot;}&quot;;</span>
<span class="fc" id="L621">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L622">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L624">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L625">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L627">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L628">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L630">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L631">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L633">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L634">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L635">		}</span>
<span class="nc" id="L636">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L637">        catch (IOException e) {}</span>
        
<span class="fc" id="L639">        Field iParserObject = null;</span>
<span class="fc" id="L640">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L643">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L644">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L645">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L646">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L647">		}</span>
<span class="nc" id="L648">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L649">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L651">		ctrlAdminObject.ctrlModifyProcess(request, response);</span>
<span class="fc" id="L652">		assertNotNull(iParserObject);</span>
<span class="fc" id="L653">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L654">    }</span>
    
    /**
	 *	Test del metodo ctrlCreateProcess() che permette ad un amministratore di creare un nuovo processo.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlCreateProcess() throws Exception {
<span class="fc" id="L662">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L663">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L664">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L665">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
<span class="fc" id="L666">        Notification notificationObject = new Notification();</span>
        
<span class="fc" id="L668">        HibernateUtil.getSession().beginTransaction();</span>
        //creazione amministratore
<span class="fc" id="L670">        User testAdmin = new User();</span>
<span class="fc" id="L671">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L672">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L673">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L674">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L675">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
<span class="fc" id="L676">        HibernateUtil.commitTransaction();</span>
        
        //creazione processo
<span class="fc" id="L679">        Process testProcess = new Process();</span>
<span class="fc" id="L680">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L681">        testProcess.setAvailable(true);</span>
<span class="fc" id="L682">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L683">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L684">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L685">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L686">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L687">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
	    
        //creazione di un passo per il processo
<span class="fc" id="L690">        Step testStep = new Step();</span>
<span class="fc" id="L691">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L692">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L693">        testStep.setIsGeolocation(false);</span>
<span class="fc" id="L694">        testStep.setIsPhoto(false);</span>
<span class="fc" id="L695">        testStep.setIsText(false);</span>
<span class="fc" id="L696">        testStep.setLevel(1);</span>
<span class="fc" id="L697">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L698">        testStep.setParallelism(EnumParallelism.AND);</span>
        
<span class="fc" id="L700">        JSONObject date = new JSONObject();</span>
<span class="fc" id="L701">		date.put(&quot;Year&quot;, 2020);</span>
<span class="fc" id="L702">		date.put(&quot;Month&quot;, 12);</span>
<span class="fc" id="L703">		date.put(&quot;Day&quot;, 31);</span>
		
<span class="fc" id="L705">        String processData = new String(&quot;Name: 'test', Description: 'test', TotalLevel: 1, PublicationDate: &quot;+date+&quot;, ClosingDate: &quot;+date+&quot;, EndSubscriptionDate: &quot;+date+&quot;, Available: true&quot;);</span>
<span class="fc" id="L706">        JSONArray stepArray = new JSONArray();</span>
        
<span class="fc" id="L708">        JSONObject stepData = new JSONObject();</span>
<span class="fc" id="L709">		stepData.put(&quot;Level&quot; , 1);</span>
<span class="fc" id="L710">		stepData.put(&quot;Description&quot;, &quot;test&quot;);</span>
<span class="fc" id="L711">		stepData.put(&quot;IsPhoto&quot;, true);</span>
<span class="fc" id="L712">		stepData.put(&quot;IsText&quot;, true);</span>
<span class="fc" id="L713">		stepData.put(&quot;IsGeolocation&quot;, true);</span>
<span class="fc" id="L714">		stepData.put(&quot;CheckText&quot;, &quot;&quot;);</span>
<span class="fc" id="L715">		stepData.put(&quot;CheckLatitude&quot;, &quot;&quot;);</span>
<span class="fc" id="L716">		stepData.put(&quot;CheckLongitude&quot;, &quot;&quot;);</span>
<span class="fc" id="L717">		stepData.put(&quot;AdminVerify&quot;, false);</span>
<span class="fc" id="L718">		stepData.put(&quot;Parallelism&quot; , &quot;NOT&quot;);</span>
<span class="fc" id="L719">		stepData.put(&quot;IdProcess&quot; , testProcess.getIdProcess());</span>
<span class="fc" id="L720">        stepArray.put(stepData);</span>
        
<span class="fc" id="L722">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, &quot;+processData+&quot;, Steps: &quot;+stepArray+&quot;}&quot;;</span>
<span class="fc" id="L723">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L724">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L726">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L727">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L729">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L730">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L732">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L733">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L735">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L736">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L737">		}</span>
<span class="nc" id="L738">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L739">        catch (IOException e) {}</span>
        
<span class="fc" id="L741">        Field iParserObject = null;</span>
<span class="fc" id="L742">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L745">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L746">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L747">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L748">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L749">		}</span>
<span class="nc" id="L750">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L751">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L753">		ctrlAdminObject.ctrlCreateProcess(request, response, notificationObject);</span>
<span class="fc" id="L754">		assertNotNull(iParserObject);</span>
<span class="fc" id="L755">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L756">    }</span>
    
    /**
	 *	Test del metodo ctrlStepValidation() che permette ad un amministratore di valutare i dati di un passo.
     * @throws Exception segnala un problema di connessione al database
	 */
	@Test
    public void testCtrlStepValidation() throws Exception {
<span class="fc" id="L764">    	HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L765">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L766">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L767">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L770">        HibernateUtil.getSession().beginTransaction();</span>
        
        //creazione amministratore
<span class="fc" id="L773">        User testAdmin = new User();</span>
<span class="fc" id="L774">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L775">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L776">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L777">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L778">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
        
        //creazione utente
<span class="fc" id="L781">        User testUser = new User();</span>
<span class="fc" id="L782">        testUser.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L783">        testUser.setIsAdmin(false);</span>
<span class="fc" id="L784">        testUser.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L785">        testUser.setUsername(&quot;testUser&quot;);</span>
<span class="fc" id="L786">        HibernateUtil.getSession().saveOrUpdate(testUser);</span>
        
        //creazione processo
<span class="fc" id="L789">        Process testProcess = new Process();</span>
<span class="fc" id="L790">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L791">        testProcess.setAvailable(true);</span>
<span class="fc" id="L792">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L793">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L794">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L795">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L796">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L797">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L798">        HibernateUtil.getSession().saveOrUpdate(testProcess);</span>
        
        //creazione di un passo per il processo
<span class="fc" id="L801">        Step testStep = new Step();</span>
<span class="fc" id="L802">        testStep.setAdminVerify(false);</span>
<span class="fc" id="L803">        testStep.setDescription(&quot;test&quot;);</span>
<span class="fc" id="L804">        testStep.setIsGeolocation(false);</span>
<span class="fc" id="L805">        testStep.setIsPhoto(false);</span>
<span class="fc" id="L806">        testStep.setIsText(false);</span>
<span class="fc" id="L807">        testStep.setLevel(1);</span>
<span class="fc" id="L808">        testStep.setIdProcess(testProcess);</span>
<span class="fc" id="L809">        testStep.setParallelism(EnumParallelism.AND);</span>
<span class="fc" id="L810">        HibernateUtil.getSession().saveOrUpdate(testStep);</span>
    	
        //iscrizione dell'utente al processo 
<span class="fc" id="L813">        Subscription testSubscription = new Subscription();</span>
<span class="fc" id="L814">        testSubscription.setComplete(false);</span>
<span class="fc" id="L815">        testSubscription.setIdUser(testUser);</span>
<span class="fc" id="L816">        testSubscription.setIdProcess(testProcess);</span>
<span class="fc" id="L817">        HibernateUtil.getSession().saveOrUpdate(testSubscription);</span>
        
        //creazione di una data collection
<span class="fc" id="L820">        DataCollection testCollection = new DataCollection();</span>
<span class="fc" id="L821">        testCollection.setText(&quot;test&quot;);</span>
<span class="fc" id="L822">        testCollection.setState(EnumState.TOVERIFY);</span>
<span class="fc" id="L823">        testCollection.setIdStep(testStep);</span>
<span class="fc" id="L824">        testCollection.setIdUser(testUser);</span>
<span class="fc" id="L825">        testCollection.setWrongText(true);</span>
<span class="fc" id="L826">        testCollection.setWrongPhoto(true);</span>
<span class="fc" id="L827">        testCollection.setWrongGeolocation(true);</span>
<span class="fc" id="L828">        HibernateUtil.getSession().saveOrUpdate(testCollection);</span>
<span class="fc" id="L829">        HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L831">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser().toString()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, IdCollection: &quot;+testCollection.getIdCollection()+&quot;, WrongText: true, WrongGeolocation: true, WrongPhoto: true&quot;+&quot;, IdStep: &quot;+testCollection.getIdStep().getIdStep()+&quot;}&quot;;</span>
<span class="fc" id="L832">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L833">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L835">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L836">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L838">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L839">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L841">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L842">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L844">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L845">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L846">		}</span>
<span class="nc" id="L847">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L848">        catch (IOException e) {}</span>
        
<span class="fc" id="L850">        Field iParserObject = null;</span>
<span class="fc" id="L851">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L854">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L855">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L856">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L857">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L858">		}</span>
<span class="nc" id="L859">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L860">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L862">		ctrlAdminObject.ctrlStepValidation(request, response);</span>
<span class="fc" id="L863">		assertNotNull(iParserObject);</span>
<span class="fc" id="L864">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L865">    }</span>
    
	/**
	 *	Test del metodo ctrlListUserProcess() che permette ad un amministratore di visualizzare la lista degli utenti che partecipano ai processi da lui creati.
	 * @throws Exception segnala un problema di connessione al database
	 */
	@Test
    public void testCtrlListUserProcess() throws Exception {
<span class="fc" id="L873">        HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L874">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L875">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L876">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L879">        HibernateUtil.getSession().beginTransaction();</span>
        
        //creazione amministratore
<span class="fc" id="L882">        User testAdmin = new User();</span>
<span class="fc" id="L883">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L884">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L885">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L886">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L887">        HibernateUtil.getSession().saveOrUpdate(testAdmin);</span>
        
        //creazione processo
<span class="fc" id="L890">        Process testProcess = new Process();</span>
<span class="fc" id="L891">        testProcess.setAdmin(testAdmin);</span>
<span class="fc" id="L892">        testProcess.setAvailable(true);</span>
<span class="fc" id="L893">        testProcess.setDescription(&quot;Processo di test&quot;);</span>
<span class="fc" id="L894">        testProcess.setEndSubscriptionDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L895">        testProcess.setClosingDate(new GregorianCalendar(2020,12,31,23,59,59));</span>
<span class="fc" id="L896">        testProcess.setTotalLevel(1);</span>
<span class="fc" id="L897">        testProcess.setName(&quot;test&quot;);</span>
<span class="fc" id="L898">        testProcess.setPublicationDate(new GregorianCalendar(2012,12,31,23,59,59));</span>
<span class="fc" id="L899">        HibernateUtil.getSession().saveOrUpdate(testProcess);  </span>
<span class="fc" id="L900">	    HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L902">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;, IdProcess: &quot;+testProcess.getIdProcess()+&quot;}&quot;;</span>
<span class="fc" id="L903">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L904">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L906">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L907">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L909">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L910">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L912">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L913">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L915">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L916">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L917">		}</span>
<span class="nc" id="L918">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L919">        catch (IOException e) {}</span>
        
<span class="fc" id="L921">        Field iParserObject = null;</span>
<span class="fc" id="L922">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L925">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L926">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L927">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L928">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L929">		}</span>
<span class="nc" id="L930">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L931">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L933">		ctrlAdminObject.ctrlListUserProcess(request, response);</span>
<span class="fc" id="L934">		assertNotNull(iParserObject);</span>
<span class="fc" id="L935">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L936">    }</span>
	
    /**
	 *	Test del metodo ctrlViewAdminProcessActive() che permette ad un amministratore di visualizzare tutti i processi attivi e da lui creati.
     * @throws Exception segnala un problema di connessione al database
	 */
	@Test
    public void testCtrlViewAdminProcessActive() throws Exception {
<span class="fc" id="L944">        HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L945">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L946">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L947">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L950">        HibernateUtil.getSession().beginTransaction();</span>
        
        //creazione amministratore
<span class="fc" id="L953">        User testAdmin = new User();</span>
<span class="fc" id="L954">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L955">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L956">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L957">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L958">        HibernateUtil.getSession().saveOrUpdate(testAdmin);      </span>
<span class="fc" id="L959">	    HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L961">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;}&quot;;</span>
<span class="fc" id="L962">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L963">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L965">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L966">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L968">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L969">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L971">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L972">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L974">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L975">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L976">		} </span>
<span class="nc" id="L977">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L978">        catch (IOException e) {}</span>
        
<span class="fc" id="L980">        Field iParserObject = null;</span>
<span class="fc" id="L981">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L984">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L985">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L986">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L987">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L988">		}</span>
<span class="nc" id="L989">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L990">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L992">		ctrlAdminObject.ctrlViewAdminProcessActive(request, response);</span>
<span class="fc" id="L993">		assertNotNull(iParserObject);</span>
<span class="fc" id="L994">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L995">    }</span>
    
    /**
	 *	Test del metodo ctrlStepListValidation() che permette ad un amministratore di visualizzare la lista di tutti i passi ancora da validare.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlStepListValidation() throws Exception {
<span class="fc" id="L1003">        HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L1004">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L1005">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L1006">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L1009">        HibernateUtil.getSession().beginTransaction();</span>
        
        //creazione amministratore
<span class="fc" id="L1012">        User testAdmin = new User();</span>
<span class="fc" id="L1013">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L1014">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L1015">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L1016">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L1017">        HibernateUtil.getSession().saveOrUpdate(testAdmin);      </span>
<span class="fc" id="L1018">	    HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L1020">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;}&quot;;</span>
<span class="fc" id="L1021">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L1022">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L1024">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L1025">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L1027">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L1028">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L1030">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L1031">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L1033">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L1034">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L1035">		}</span>
<span class="nc" id="L1036">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L1037">        catch (IOException e) {}</span>
        
<span class="fc" id="L1039">        Field iParserObject = null;</span>
<span class="fc" id="L1040">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L1043">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L1044">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L1045">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L1046">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L1047">		}</span>
<span class="nc" id="L1048">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L1049">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L1051">		ctrlAdminObject.ctrlStepListValidation(request, response);</span>
<span class="fc" id="L1052">		assertNotNull(iParserObject);</span>
<span class="fc" id="L1053">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L1054">    }</span>
    
    /**
	 *	Test del metodo ctrlViewAllProcesses() che permette ad un amministratore di visualizzare tutti i processi dell'applicazione.
     * @throws Exception segnala un problema di connessione al database
	 */
    @Test
    public void testCtrlViewAllProcesses() throws Exception {
<span class="fc" id="L1062">        HttpServletRequest request = mock(HttpServletRequest.class);</span>
<span class="fc" id="L1063">        HttpServletResponse response = mock(HttpServletResponse.class);</span>
<span class="fc" id="L1064">        HttpSession session= mock(HttpSession.class);</span>
<span class="fc" id="L1065">        CtrlAdmin ctrlAdminObject = new CtrlAdmin();</span>
        
        //creazione ambiente per l'esecuzione della query
<span class="fc" id="L1068">        HibernateUtil.getSession().beginTransaction();</span>
        
        //creazione amministratore
<span class="fc" id="L1071">        User testAdmin = new User();</span>
<span class="fc" id="L1072">        testAdmin.setEmail(&quot;asd@asd.com&quot;);</span>
<span class="fc" id="L1073">        testAdmin.setIsAdmin(true);</span>
<span class="fc" id="L1074">        testAdmin.setPassword(&quot;test&quot;);</span>
<span class="fc" id="L1075">        testAdmin.setUsername(&quot;test&quot;);</span>
<span class="fc" id="L1076">        HibernateUtil.getSession().saveOrUpdate(testAdmin);      </span>
<span class="fc" id="L1077">	    HibernateUtil.commitTransaction();</span>
        
<span class="fc" id="L1079">	    String stringObject = &quot;{IdUser: &quot;+testAdmin.getIdUser()+&quot;, Admin: &quot;+testAdmin.getIsAdmin()+&quot;}&quot;;</span>
<span class="fc" id="L1080">    	StringReader stringReaderObject=new StringReader(stringObject);</span>
<span class="fc" id="L1081">    	BufferedReader bufferReaderObject = new BufferedReader(stringReaderObject);</span>
        
<span class="fc" id="L1083">    	Writer writerMock = mock(Writer.class);</span>
<span class="fc" id="L1084">    	PrintWriter writer = null;</span>
        try {
<span class="fc" id="L1086">			when(request.getReader()).thenReturn(bufferReaderObject);</span>
<span class="fc" id="L1087">			when(request.getSession()).thenReturn(session);</span>
			
<span class="fc" id="L1089">			when(session.getAttribute(testAdmin.getIdUser().toString())).thenReturn(true);</span>
<span class="fc" id="L1090">			when(session.getAttribute(testAdmin.getIdUser().toString()+&quot;Admin&quot;)).thenReturn(testAdmin.getIsAdmin());</span>
			
<span class="fc" id="L1092">			writer = new PrintWriter(writerMock);</span>
<span class="fc" id="L1093">			when(response.getWriter()).thenReturn(writer);</span>
<span class="fc" id="L1094">		}</span>
<span class="nc" id="L1095">        catch (FileNotFoundException e) {}</span>
<span class="nc" id="L1096">        catch (IOException e) {}</span>
        
<span class="fc" id="L1098">        Field iParserObject = null;</span>
<span class="fc" id="L1099">		Field iServiceObject = null;</span>
		
		try {
<span class="fc" id="L1102">			iParserObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iParser&quot;);</span>
<span class="fc" id="L1103">			iParserObject.setAccessible(true);</span>
<span class="fc" id="L1104">			iServiceObject = ctrlAdminObject.getClass().getDeclaredField(&quot;iService&quot;);</span>
<span class="fc" id="L1105">			iServiceObject.setAccessible(true);</span>
<span class="fc" id="L1106">		}</span>
<span class="nc" id="L1107">		catch (NoSuchFieldException e) {}</span>
<span class="nc" id="L1108">		catch (SecurityException e) {}</span>
		
<span class="fc" id="L1110">		ctrlAdminObject.ctrlViewAllProcesses(request, response);</span>
<span class="fc" id="L1111">		assertNotNull(iParserObject);</span>
<span class="fc" id="L1112">		assertNotNull(iServiceObject);</span>
<span class="fc" id="L1113">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span>seq (1) (2-lug-2014 22.31.08)</div></body></html>